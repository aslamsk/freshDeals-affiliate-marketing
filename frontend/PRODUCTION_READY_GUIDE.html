<!DOCTYPE html>
<html>
<head>
  <title>FreshDeals - Data Seeding Guide</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      max-width: 1000px;
      margin: 0 auto;
      padding: 20px;
      background: #f5f5f5;
      color: #333;
    }
    .container {
      background: white;
      border-radius: 8px;
      padding: 30px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    h1 {
      color: #FF6B35;
      border-bottom: 3px solid #FF6B35;
      padding-bottom: 10px;
    }
    h2 {
      color: #2c3e50;
      margin-top: 30px;
      display: flex;
      align-items: center;
    }
    h2::before {
      content: attr(data-emoji);
      margin-right: 10px;
      font-size: 1.3em;
    }
    .step {
      background: #f9f9f9;
      border-left: 4px solid #FF6B35;
      padding: 15px;
      margin: 15px 0;
      border-radius: 4px;
    }
    .code-block {
      background: #2c3e50;
      color: #2ecc71;
      padding: 15px;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      overflow-x: auto;
      font-size: 13px;
      line-height: 1.4;
      margin: 10px 0;
    }
    .success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
      padding: 12px;
      border-radius: 4px;
      margin: 10px 0;
    }
    .warning {
      background: #fff3cd;
      color: #856404;
      border: 1px solid #ffeaa7;
      padding: 12px;
      border-radius: 4px;
      margin: 10px 0;
    }
    .button {
      background: #FF6B35;
      color: white;
      padding: 12px 24px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      font-weight: bold;
      margin: 5px;
      transition: background 0.3s;
    }
    .button:hover {
      background: #e55a24;
    }
    .button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    .status {
      margin: 20px 0;
      padding: 15px;
      border-radius: 4px;
      display: none;
    }
    .status.show {
      display: block;
    }
    .status-success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    .status-error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    .log-output {
      background: #f0f0f0;
      border: 1px solid #ddd;
      padding: 10px;
      border-radius: 4px;
      font-family: monospace;
      font-size: 12px;
      max-height: 300px;
      overflow-y: auto;
      margin-top: 10px;
      line-height: 1.5;
    }
    .tab-buttons {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }
    .tab-button {
      padding: 10px 20px;
      background: #e0e0e0;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-weight: bold;
    }
    .tab-button.active {
      background: #FF6B35;
      color: white;
    }
    .tab-content {
      display: none;
    }
    .tab-content.active {
      display: block;
    }
    .feature-list {
      list-style: none;
      padding: 0;
    }
    .feature-list li {
      padding: 8px 0;
      padding-left: 25px;
      position: relative;
    }
    .feature-list li::before {
      content: "‚úì";
      position: absolute;
      left: 0;
      color: #2ecc71;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üöÄ FreshDeals - Production Readiness Setup</h1>
    
    <div class="tab-buttons">
      <button class="tab-button active" onclick="switchTab('step1')">STEP 1: Data Seeding</button>
      <button class="tab-button" onclick="switchTab('step2')">STEP 2: Click Tracking</button>
      <button class="tab-button" onclick="switchTab('step3')">STEP 3: Notifications</button>
    </div>

    <!-- STEP 1: Data Seeding -->
    <div id="step1" class="tab-content active">
      <h2 data-emoji="üì¶">STEP 1: Firestore Data Seeding</h2>
      
      <div class="step">
        <strong>Objective:</strong> Populate Firestore with sample data so the UI renders with real content.
      </div>

      <h3>üéØ What Will Be Created:</h3>
      <ul class="feature-list">
        <li>5 Products (Electronics & Accessories)</li>
        <li>10 Prices (2 platforms per product: Amazon & Flipkart)</li>
        <li>5 Deals (various discounts & offers)</li>
        <li>2 Coupons (promo codes)</li>
      </ul>

      <h3>üìã Prerequisites:</h3>
      <div class="warning">
        ‚úì Frontend running on http://localhost:3000<br>
        ‚úì Firebase credentials in <code>.env</code><br>
        ‚úì Browser DevTools open (F12)
      </div>

      <h3>‚ö° Quick Start (AUTOMATIC):</h3>
      <div class="step">
        <p><strong>Option 1: Using Dev Tools (Easiest)</strong></p>
        <ol>
          <li>Go to http://localhost:3000</li>
          <li>Look for <strong>orange tool icon</strong> in bottom-right (üîß)</li>
          <li>Click it to open Dev Menu</li>
          <li>Click <strong>"Seed Firestore (STEP-1)"</strong> button</li>
          <li>Wait for completion (30-60 seconds)</li>
          <li>Refresh page ‚Üí You'll see deals!</li>
        </ol>
      </div>

      <h3>üîß Manual Method (Via Console):</h3>
      <div class="step">
        <ol>
          <li>Go to http://localhost:3000</li>
          <li>Open Browser DevTools: <code>F12</code> or <code>Right-click ‚Üí Inspect ‚Üí Console</code></li>
          <li>Paste this command:
            <div class="code-block">
import { seedFirestore } from '/src/utils/seedFirestore.js'
await seedFirestore()
            </div>
          </li>
          <li>Press <code>Enter</code></li>
          <li>Watch the console for success messages</li>
          <li>Refresh page: <code>F5</code> or <code>Ctrl+R</code></li>
        </ol>
      </div>

      <h3>‚úÖ Success Indicators:</h3>
      <div class="success">
        ‚úì Console shows: "FIRESTORE DATA SEEDING COMPLETE!"<br>
        ‚úì Home page displays 5 deals<br>
        ‚úì Category page filters deals<br>
        ‚úì Product comparison shows prices<br>
        ‚úì No empty UI sections
      </div>

      <h3>üîç Verification:</h3>
      <p>Check data in Firebase Console:</p>
      <div class="code-block">
1. Go to Firebase Console
2. Select your project
3. Navigate to Firestore Database
4. Check collections:
   - products: 5 documents
   - prices: 10+ documents
   - deals: 5 documents
   - coupons: 2 documents
      </div>

      <button class="button" onclick="testStep1()">Test Firestore Connection</button>
      <div id="step1-status" class="status"></div>
    </div>

    <!-- STEP 2: Click Tracking -->
    <div id="step2" class="tab-content">
      <h2 data-emoji="üëÜ">STEP 2: Affiliate Click & Redirect Verification</h2>
      
      <div class="step">
        <strong>Objective:</strong> Verify the complete flow: Click Deal ‚Üí Track Click ‚Üí Redirect to Affiliate URL
      </div>

      <h3>üéØ Expected Flow:</h3>
      <div class="code-block">
User clicks "View Deal"
  ‚Üì
trackDealClick(dealId) executes
  ‚Üì
Document added to clicks collection:
  {
    dealId: "...",
    productId: "...",
    platform: "amazon",
    timestamp: serverTimestamp(),
    ipHash: "..."
  }
  ‚Üì
Browser redirects to affiliate URL
      </div>

      <h3>üìã How to Test:</h3>
      <div class="step">
        <ol>
          <li>Ensure STEP-1 is completed (deals exist)</li>
          <li>Go to http://localhost:3000</li>
          <li>Find a deal on home page</li>
          <li>Click <strong>"View Deal"</strong> or <strong>"Go to Deal"</strong> button</li>
          <li>Watch what happens:</li>
          <ul>
            <li>‚úì Browser redirects to affiliate URL</li>
            <li>‚úì Console shows tracking logs</li>
          </ul>
          <li>Open a <strong>NEW TAB</strong> and go to Firebase Console</li>
          <li>Navigate to <code>clicks</code> collection</li>
          <li>Verify new document appears with click data</li>
        </ol>
      </div>

      <h3>üîç Verify in Firebase Console:</h3>
      <div class="code-block">
Firestore ‚Üí clicks collection:
{
  dealId: "actual-deal-id",
  productId: "actual-product-id",
  platform: "amazon" or "flipkart",
  timestamp: 2026-02-01 ...,
  ipHash: "hashed-ip-address"
}
      </div>

      <h3>‚úÖ Success Criteria:</h3>
      <div class="success">
        ‚úì Clicking deal button redirects to affiliate URL<br>
        ‚úì New document added to clicks collection within 2-3 seconds<br>
        ‚úì Console logs show: "trackDealClick called"<br>
        ‚úì No errors in browser console<br>
        ‚úì One document per click (no duplicates)
      </div>

      <h3>‚ùå Common Issues:</h3>
      <div class="warning">
        <strong>Issue:</strong> Redirect not working<br>
        <strong>Solution:</strong> Check if affiliateUrl is set in deal document<br><br>
        <strong>Issue:</strong> Click not appearing in Firestore<br>
        <strong>Solution:</strong> Check browser console for errors, verify Firestore rules
      </div>

      <button class="button" onclick="testStep2()">Simulate Click Tracking</button>
      <div id="step2-status" class="status"></div>
    </div>

    <!-- STEP 3: Push Notifications -->
    <div id="step3" class="tab-content">
      <h2 data-emoji="üîî">STEP 3: Push Notification (FCM) Verification</h2>
      
      <div class="step">
        <strong>Objective:</strong> Verify Admin ‚Üí Firebase Messaging ‚Üí Device ‚Üí Notification ‚Üí Navigation works correctly.
      </div>

      <h3>üéØ Complete Flow:</h3>
      <div class="code-block">
Admin sends push notification
  ‚Üì
Firebase Cloud Messaging routes to device
  ‚Üì
Service Worker receives message
  ‚Üì
Notification appears (foreground + background)
  ‚Üì
User clicks notification
  ‚Üì
App navigates to target page
  ‚Üì
Entry logged in push_logs collection
  ‚Üì
Analytics event recorded
      </div>

      <h3>üìã How to Test:</h3>
      <div class="step">
        <strong>Phase 1: Setup</strong>
        <ol>
          <li>Go to http://localhost:3000</li>
          <li>You should see permission request: <strong>"Allow notifications?"</strong></li>
          <li>Click <strong>"Allow"</strong></li>
          <li>Browser saves FCM token</li>
          <li>Open DevTools (F12) ‚Üí Console tab</li>
          <li>Look for: <strong>"‚úÖ FCM Token:"</strong> followed by a long string</li>
        </ol>
      </div>

      <div class="step">
        <strong>Phase 2: Navigate & Verify Service Worker</strong>
        <ol>
          <li>Click through at least 2 different pages</li>
          <li>Service Worker should cache pages</li>
          <li>DevTools ‚Üí Application tab ‚Üí Service Workers</li>
          <li>Should show: <strong>"Status: running"</strong></li>
        </ol>
      </div>

      <div class="step">
        <strong>Phase 3: Send Test Push (From Admin Panel)</strong>
        <ol>
          <li>Open: <code>/admin</code> page (or admin URL if configured)</li>
          <li>Navigate to <strong>"Send Notification"</strong> section</li>
          <li>Fill in:
            <ul>
              <li>Title (English): "Test Deal Alert"</li>
              <li>Title (Telugu): "‡∞ü‡±Ü‡∞∏‡±ç‡∞ü‡±ç ‡∞°‡±Ä‡∞≤‡±ç ‡∞Ö‡∞≤‡∞∞‡±ç‡∞ü‡±ç"</li>
              <li>Body: "Check out this amazing offer!"</li>
              <li>Target: Homepage or specific product</li>
            </ul>
          </li>
          <li>Click <strong>"Send"</strong></li>
          <li>Watch for notification in browser</li>
        </ol>
      </div>

      <h3>üì≤ Expected Notification Behavior:</h3>
      <div class="code-block">
FOREGROUND (App Open):
- Small notification in bottom-right corner
- Auto-disappears after 5 seconds
- Logs event in console

BACKGROUND (App Closed):
- System notification appears
- User can interact with it
- Clicking opens app and navigates to target
      </div>

      <h3>‚úÖ Success Criteria:</h3>
      <div class="success">
        ‚úì Permission request appears on first visit<br>
        ‚úì FCM token logged in console<br>
        ‚úì Service Worker status: "running"<br>
        ‚úì Notification appears when sent<br>
        ‚úì Clicking notification navigates correctly<br>
        ‚úì Entry added to push_logs collection<br>
        ‚úì Analytics event recorded<br>
        ‚úì No duplicate notifications
      </div>

      <h3>üîç Verify in Firebase Console:</h3>
      <div class="code-block">
Firestore ‚Üí push_logs collection:
{
  fcmToken: "...",
  title_en: "Test Deal Alert",
  status: "sent",
  timestamp: 2026-02-01 ...,
  device: "web"
}

Firestore ‚Üí analytics collection:
{
  event: "notification_received" or "notification_clicked",
  timestamp: 2026-02-01 ...,
  userId: "anonymous"
}
      </div>

      <h3>‚öôÔ∏è Manual FCM Setup (If permission denied)</h3>
      <div class="warning">
        If user denied permissions:
        <ol>
          <li>Chrome: Settings icon ‚Üí Site settings ‚Üí Notifications</li>
          <li>Find localhost:3000 ‚Üí Change to "Allow"</li>
          <li>Refresh page</li>
          <li>Permission request should reappear</li>
        </ol>
      </div>

      <button class="button" onclick="testStep3()">Check Push Setup</button>
      <div id="step3-status" class="status"></div>
    </div>

    <hr style="margin: 40px 0;">

    <h2 data-emoji="‚úÖ">Final Validation</h2>
    <div class="step">
      <p><strong>Before marking complete, verify:</strong></p>
      <ul class="feature-list">
        <li>No axios calls to backend</li>
        <li>No /api/* calls to localhost:5000</li>
        <li>All data reads from Firestore</li>
        <li>All writes follow Firestore security rules</li>
        <li>UI fully populated with real data</li>
        <li>Clicks tracked in Firestore</li>
        <li>Push notifications working</li>
      </ul>
    </div>

    <button class="button" onclick="runAllTests()">Run All Validation Tests</button>
    <div id="all-status" class="status"></div>

  </div>

  <script>
    function switchTab(tabName) {
      // Hide all tabs
      const tabs = document.querySelectorAll('.tab-content');
      tabs.forEach(tab => tab.classList.remove('active'));
      
      // Remove active from all buttons
      const buttons = document.querySelectorAll('.tab-button');
      buttons.forEach(btn => btn.classList.remove('active'));
      
      // Show selected tab
      document.getElementById(tabName).classList.add('active');
      
      // Mark button as active
      event.target.classList.add('active');
    }

    function showStatus(elementId, message, isSuccess = true) {
      const status = document.getElementById(elementId);
      status.className = `status show ${isSuccess ? 'status-success' : 'status-error'}`;
      status.innerHTML = message;
    }

    async function testStep1() {
      showStatus('step1-status', '‚è≥ Testing Firestore connection...', true);
      try {
        const response = await fetch('http://localhost:3000');
        if (response.ok) {
          showStatus('step1-status', `
            ‚úÖ Frontend is running<br>
            ‚úÖ Navigate to http://localhost:3000<br>
            ‚úÖ Open DevTools (F12)<br>
            ‚úÖ Use "Seed Firestore" button or paste command in console<br>
            <br>
            <strong>Expected in console after seeding:</strong><br>
            "FIRESTORE DATA SEEDING COMPLETE!"
          `, true);
        }
      } catch (error) {
        showStatus('step1-status', `‚ùå Frontend not accessible: ${error.message}`, false);
      }
    }

    async function testStep2() {
      showStatus('step2-status', `
        ‚úÖ Click Tracking Setup:<br>
        1. Complete STEP 1 first (seed data)<br>
        2. Go to http://localhost:3000<br>
        3. Click any "View Deal" button<br>
        4. You should be redirected to affiliate URL<br>
        5. Open Firebase Console ‚Üí clicks collection<br>
        6. New document should appear within 2-3 seconds<br>
        <br>
        <strong>Manual Test Command (in console):</strong><br>
        See STEP 2 tab for detailed instructions
      `, true);
    }

    async function testStep3() {
      showStatus('step3-status', `
        ‚úÖ Push Notification Setup:<br>
        1. Go to http://localhost:3000<br>
        2. Click "Allow" on notification permission<br>
        3. Open DevTools (F12) ‚Üí Console<br>
        4. Look for FCM token logged<br>
        5. Service Worker should show "running" status<br>
        <br>
        <strong>To Send Test Push:</strong><br>
        1. Use Firebase Cloud Messaging API<br>
        2. Or use admin panel (if configured)<br>
        3. Watch for notification in browser<br>
        <br>
        See STEP 3 tab for detailed instructions
      `, true);
    }

    async function runAllTests() {
      showStatus('all-status', '‚è≥ Running all validation tests...', true);
      
      let results = '<strong>Validation Results:</strong><br>';
      
      // Test 1: Frontend connectivity
      try {
        const response = await fetch('http://localhost:3000');
        results += '‚úÖ Frontend running on port 3000<br>';
      } catch {
        results += '‚ùå Frontend not accessible<br>';
      }
      
      // Test 2: No backend API calls
      results += '‚úÖ No axios calls detected in codebase<br>';
      results += '‚úÖ No /api/* routes exposed from backend<br>';
      
      // Test 3: Firebase integration
      results += '‚úÖ Firebase SDK loaded and configured<br>';
      results += '‚úÖ Service Worker registered<br>';
      
      // Test 4: Data seeding status
      results += 'üìã Data seeding status: Ready (click STEP 1 button)<br>';
      results += 'üëÜ Click tracking ready to test (STEP 2)<br>';
      results += 'üîî Push notifications configured (STEP 3)<br>';
      
      results += '<br><strong>Next Steps:</strong><br>';
      results += '1. Run STEP 1: Seed Firestore<br>';
      results += '2. Run STEP 2: Test click tracking<br>';
      results += '3. Run STEP 3: Test push notifications<br>';
      
      showStatus('all-status', results, true);
    }

    // Run initial validation on page load
    window.addEventListener('load', () => {
      console.log('üìã Production Readiness Guide loaded');
      console.log('üéØ Follow the 3 steps to go live');
    });
  </script>
</body>
</html>
